<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Albatross Expression Api </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Albatross Expression Api ">
    <meta name="generator" content="docfx 2.31.0.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container-fluid">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav container-fluid navbar navbar-default">
          <div class="hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container-fluid body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="albatross-expression-api">Albatross Expression Api</h1>

<h2 id="summary">Summary</h2>
<p><a class="xref" href="../api/Albatross.Expression.html">Albatross.Expression</a> is a text expression parser.  It can evaluate the value of a text expression.  It can also parse a text expression and use the model to produce another expression of different format.</p>
<h2 id="description">Description</h2>
<p>The Api supports </p>
<ul>
<li>infix operator: 1 + 1</li>
<li>prefix operations: 1 - -2 (the negative sign is a prefix operator )</li>
<li>functions: max(1, 2, 3)</li>
</ul>
<p><a class="xref" href="../api/Albatross.Expression.html">Albatross.Expression</a> parses the expression by</p>
<ol>
<li>Tokenize the text</li>
<li>Build a stack</li>
<li>Create a token tree</li>
</ol>
<p>Once the token tree is created, the parser will evaluate the result of the expression by evaluating the tree nodes recursively.  </p>
<h2 id="why-not-evaluate-the-expression-after-step-2-using-the-stack">Why not evaluate the expression after step 2, using the stack?</h2>
<p>It is true that the value can be evaluated using the stack.  But the stack would be popped during the evaluation process and it cannot be reused.  The token tree however can be called repeately.</p>
<h2 id="why-would-you-want-to-reuse-an-expression-tree">Why would you want to reuse an expression tree?</h2>
<p>There is no reason to reused an expression if it is made of literals such as 1 + 1.  However if an expression is created using variables: a + b.  Its value will depends on the input variable.  Once constructed, the tree can be invoked repeatedly using different input values.</p>
<h2 id="how-to-construct-an-expression-using-variables">How to construct an expression using variables?</h2>
<h1 id="projects">Projects</h1>
<ul>
<li><a class="xref" href="../api/Albatross.Expression.html">Albatross.Expression</a> - Class and interface definition</li>
<li><a href="xref:Albatross.Expression.Test">Albatross.Expression.Test</a> - Unit test using NUnit</li>
</ul>
<h1 id="how-to-use-the-api">How to use the Api</h1>
<p>Albatross.Expression is a single statement expression parser.  </p>
<p>The Albatross.Expression.IParser is the main interface that will tokenize an expression, build the stack and eventually create a final token for evaluation.</p>
<p>The standard parser Albatross.Expression.Parser supports both infix and prefix operations.  The static method Parser.GetParser() will construct the parser with all supported operations.<br>If new operations need to be added, it is easy to create the new operations and add it manually.  There is no need to reimplement the Parser class because the logic of tokenizing, building stack and building tree are the same for most kinds of expressions.</p>
<p>The arithmetic operations such as plus, minus, sum, etc. only support C# double types for the sake of simplicity.  This again is a implementation of the operations rather than the parser itself.</p>
<p>The ExecutionContext class is an useful utility class that can hold a set of expressions.
Expression such as:</p>
<ol>
<li>MV = Price * Qty;</li>
<li>Price = (Bid + Ask)/2;</li>
<li>Bid = .6;</li>
<li>Ask = .8;</li>
</ol>
<p>can be created and evaluated using the ExecutionContext class.  The Compile function will build the expressions and detect circular reference.  Recursive expressions are not supported and will be considered as circular.</p>
<p>After the token tree has been created, the Eval function of the IToken object is thread safe.  Same can be said for the GetValue function of the ExecutionContext object after it has been compiled.</p>
<ol>
<li><a href="https://github.com/RushuiGuan/Albatross/wiki/Expression-Operations">List of Operations</a></li>
</ol>
<p>Here is some code example:</p>
<pre><code>// simple evaluation
object value = Parser.GetParser().Compile(&quot;4 + 6&quot;).EvalValue(null);
Console.WriteLine(value);

// evaluation with an external variable
Dictionary&lt;string, object&gt; variables = new Dictionary&lt;string, object&gt;();
Func&lt;string, object&gt; func = new Func&lt;string, object&gt;(name =&gt; variables[name]);
variables.Add(&quot;a&quot;, 4);
value = Parser.GetParser().Compile(&quot;a + 6&quot;).EvalValue(func);
Console.WriteLine(value);

//evaluation with an execution context
ExecutionContext context = new ExecutionContext();
context.SetExpression(&quot;b&quot;, &quot;a + 6&quot;);
context.SetValue(&quot;a&quot;, 4);
Console.WriteLine(context.GetValue(&quot;b&quot;, null));

//evaluation expressions with multiple dependencies
context.SetExpression(&quot;c&quot;, &quot;b * a&quot;);
Console.WriteLine(context.GetValue(&quot;c&quot;, null));

//evaluation expressions with external dependencies
context.Clear();
//a is the external dependency that comes from the dictionary object;
context.SetExpression(&quot;b&quot;, &quot;a + 6&quot;);
context.SetExpression(&quot;c&quot;, &quot;b * a&quot;);
context.GetExternalData = (name, input) =&gt; ((IDictionary&lt;string, object&gt;)input)[name];
Console.WriteLine(context.GetValue(&quot;c&quot;, variables));
</code></pre></article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/RushuiGuan/expression/blob/master/docfx_project/articles/Untitled-1.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container-fluid">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Copyright © 2018</span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
